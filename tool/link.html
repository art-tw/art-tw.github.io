<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動態網址生成器</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; line-height: 1.6; background-color: #f9f9f9; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 8px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: transform 0.2s, background 0.3s;
        }
        .btn:hover { background-color: #218838; transform: translateY(-2px); }
        .info { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; font-size: 0.9em; color: #495057; }
        .error { color: #dc3545; font-weight: bold; }
        h2 { border-bottom: 2px solid #28a745; padding-bottom: 10px; margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>生成的連結清單</h2>
    <div id="infoBox" class="info">準備中...</div>
    <div id="linkContainer"></div>
</div>

<script>
    // --- 自行設定網址對照表 ---
    const urlMap = {
        "1": "https://starbucks-pos.12cm.com.tw/user-coupons/",//星巴客
        "2": "https://txp.rs/viewvoucher.aspx?voucherguid="//Edenred宜睿電子票券
    };

    function generateLinks() {
        const params = new URLSearchParams(window.location.search);
        const src = params.get('src');
        const encodedCode = params.get('code');
        
        const infoBox = document.getElementById('infoBox');
        const container = document.getElementById('linkContainer');

        if (!src || !encodedCode) {
            infoBox.innerHTML = '<span class="error">錯誤：缺少必要的參數。</span><br>請確保網址包含 ?src=&code=...';
            return;
        }

        const baseUrl = urlMap[src];
        if (!baseUrl) {
            infoBox.innerHTML = `<span class="error">錯誤：無效的來源編號 (src=${src})。</span>`;
            return;
        }

        try {
            // --- 執行 atob 解碼 ---
            // 假設輸入的 code 是經過 btoa("123,456,789") 轉換後的字串
            const decodedString = atob(encodedCode);
            const codes = decodedString.split(',');

            infoBox.innerHTML = `<strong>來源模式：</strong> ${src} (已成功解碼)`;

            // --- 遍歷生成按鈕 ---
            codes.forEach((code, index) => {
                const trimmedCode = code.trim();
                if (trimmedCode) {
                    const finalUrl = baseUrl + trimmedCode;
                    const btn = document.createElement('a');
                    btn.href = finalUrl;
                    btn.className = 'btn';
                    btn.target = '_blank';
                    // 顯示為 連結【1】, 連結【2】... (index 從 0 開始所以要 +1)
                    btn.innerText = `連結【${index + 1}】`;
                    container.appendChild(btn);
                }
            });
        } catch (e) {
            infoBox.innerHTML = '<span class="error">錯誤：code 參數解碼失敗 (Base64 格式不正確)。</span>';
            console.error(e);
        }
    }

    window.onload = generateLinks;
</script>

</body>
</html>